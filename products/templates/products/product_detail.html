{% extends 'base/base.html' %}

{% block content %}

<div class="bg-gray-100">
    <div class="container mx-auto px-4 py-8">
      <div class="flex flex-wrap -mx-4">
        <!-- Product Images -->
        <div class="w-full md:w-1/2 px-4 mb-8">
          <img src="{{ product_images.first.image.url }}" alt="Product"
                      class="w-9/12 h-auto rounded-lg shadow-md mx-auto mb-4" id="mainImage">
          <!-- <img src="https://images.unsplash.com/photo-1505740420928-5e560c06d30e?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NzEyNjZ8MHwxfHNlYXJjaHwxfHxoZWFkcGhvbmV8ZW58MHwwfHx8MTcyMTMwMzY5MHww&ixlib=rb-4.0.3&q=80&w=1080" alt="Product"
                      class="w-full h-auto rounded-lg shadow-md mb-4" id="mainImage"> -->
          <div class="flex gap-4 py-4 justify-center overflow-x-auto">
            {% for item in product_images %}
              <img src="{{ item.image.url }}" alt="Thumbnail 1"
              class="size-16 sm:size-20 object-cover rounded-md cursor-pointer opacity-60 hover:opacity-100 transition duration-300"
              onclick="changeImage(this.src)">
            {% endfor %}
            <!-- <img src="https://images.unsplash.com/photo-1484704849700-f032a568e944?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NzEyNjZ8MHwxfHNlYXJjaHw0fHxoZWFkcGhvbmV8ZW58MHwwfHx8MTcyMTMwMzY5MHww&ixlib=rb-4.0.3&q=80&w=1080" alt="Thumbnail 2"
                          class="size-16 sm:size-20 object-cover rounded-md cursor-pointer opacity-60 hover:opacity-100 transition duration-300"
                          onclick="changeImage(this.src)">
            <img src="https://images.unsplash.com/photo-1496957961599-e35b69ef5d7c?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NzEyNjZ8MHwxfHNlYXJjaHw4fHxoZWFkcGhvbmV8ZW58MHwwfHx8MTcyMTMwMzY5MHww&ixlib=rb-4.0.3&q=80&w=1080" alt="Thumbnail 3"
                          class="size-16 sm:size-20 object-cover rounded-md cursor-pointer opacity-60 hover:opacity-100 transition duration-300"
                          onclick="changeImage(this.src)">
            <img src="https://images.unsplash.com/photo-1528148343865-51218c4a13e6?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w0NzEyNjZ8MHwxfHNlYXJjaHwzfHxoZWFkcGhvbmV8ZW58MHwwfHx8MTcyMTMwMzY5MHww&ixlib=rb-4.0.3&q=80&w=1080" alt="Thumbnail 4"
                          class="size-16 sm:size-20 object-cover rounded-md cursor-pointer opacity-60 hover:opacity-100 transition duration-300"
                          onclick="changeImage(this.src)"> -->
          </div>
        </div>
  
        <!-- Product Details -->
        <div class="w-full md:w-1/2 px-4">
          <h2 class="text-3xl font-bold mb-2">{{ product.name }}</h2>
          <p class="text-gray-600 mb-4">BRAND : {{ product.brand_name }}</p>
          <div class="mb-4">
            <span class="text-2xl font-bold mr-2" id="product-price">&#8377; {{ product.original_price }}</span>
            <!-- <span class="text-gray-500 line-through">$399.99</span> -->
          </div>
          <!-- <div class="flex items-center mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
              class="size-6 text-yellow-500">
              <path fill-rule="evenodd"
                d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                clip-rule="evenodd" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
              class="size-6 text-yellow-500">
              <path fill-rule="evenodd"
                d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                clip-rule="evenodd" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
              class="size-6 text-yellow-500">
              <path fill-rule="evenodd"
                d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                clip-rule="evenodd" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
              class="size-6 text-yellow-500">
              <path fill-rule="evenodd"
                d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                clip-rule="evenodd" />
            </svg>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"
              class="size-6 text-yellow-500">
              <path fill-rule="evenodd"
                d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z"
                clip-rule="evenodd" />
            </svg>
            <span class="ml-2 text-gray-600">4.5 (120 reviews)</span>
          </div> -->
          {% comment %}
          <!-- <p class="text-gray-700 mb-6">{{ product.description }}</p> -->
          {% endcomment %}

        <form action="{% url 'current-added-products' %}?product_slug={{ product.slug }}" method="POST">
        <!-- <form action="" method="POST"> -->
          {% csrf_token %}
          <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2">Color:</h3>
            <div class="flex space-x-2">
              {% for item in product_colors %}
                <div>
                  <label for="color-{{ item.name }}">{{ item.name }}</label>
                  <input type="radio" name="color" id="color-{{ item.name }}" value="{{ item.id }}" onchange="fetchSizeData(this.value)" class="color-input-field"
                  {% if forloop.first %}
                    {{ "checked" }}
                  {% endif %}
                  />
                </div>
              {% endfor %}
            </div>
          </div>

          <div class="mb-6">
            <h3 class="text-lg font-semibold mb-2">Available SIZES:</h3>
            <div class="flex space-x-2" id="product-size-div">
              {% for item in product_sizes %}
                <div>
                  <label for="size-{{ item.size }}">{{ item.size }}</label>
                  <input type="radio" name="size" id="size-{{ item.size }}" value="{{ item.id }}" class="size-input-field"
                  {% if forloop.first %}
                    {{ "checked" }}
                  {% endif %}
                  />
                </div>
              {% endfor %}
            </div>
          </div>
  
          <div class="flex space-x-4 mb-6">
            <button
              class="bg-indigo-600 flex gap-2 items-center text-white px-6 py-2 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2" type="submit">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                  stroke-width="1.5" stroke="currentColor" class="size-6">
                  <path stroke-linecap="round" stroke-linejoin="round"
                      d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 0 0-16.536-1.84M7.5 14.25 5.106 5.272M6 20.25a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Zm12.75 0a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />
              </svg>
              Add to Cart
            </button>
          </div>

        </form>

          <div>
            <h3 class="text-lg font-semibold mb-2">Key Features:</h3>
            <p class="text-gray-700 mb-6">{{ product.description }}</p>
          </div>
        </div>
      </div>
    </div> 
  </div>

{% endblock %}

{% block script %}
<script>
  function changeImage(src) {
          document.getElementById('mainImage').src = src;
      }
  function fetchSizeData(value)
  {
    let url = `/products/fetch-size-detail/{{ product.slug | safe }}/${value}/`;
    let incoming_data = [];
    fetch(url)
    .then((res)=>res.json())
    .then((data)=>{
      let div = document.querySelector("#product-size-div");
      while(div.firstChild)
      {
        div.firstChild.remove()
      }
      data.forEach(element => {
        let innerDiv = document.createElement('div');

        let label = document.createElement('label');
        let text = document.createTextNode(`${element.size} `);
        label.appendChild(text);
        label.setAttribute('for',`size-${element.size}`);

        let input = document.createElement('input');
        input.setAttribute('type', 'radio');
        input.setAttribute('name','size');
        input.setAttribute('id', `size-${element.size}`);
        input.setAttribute('value',element.id);
        input.onchange = fetchPriceData
        input.setAttribute('class',"size-input-field")

        innerDiv.appendChild(label);
        innerDiv.appendChild(input);

        div.appendChild(innerDiv);
      });
    });
    
  }

  let inputFields = document.querySelectorAll('.size-input-field');
  inputFields.forEach((elem)=>{
    elem.onchange = fetchPriceData
  });

  function fetchPriceData(event)
  {
    input_fields = document.querySelectorAll('.color-input-field');
    let checked_input_field;
    for(let i=0; i<2; i++)
    {
      if(input_fields[i].checked)
      {
        checked_input_field = input_fields[i];
      }
    }
    let url = `/products/fetch-size-price-detail/{{ product.slug | safe }}/${checked_input_field.value}/${event.target.value}/`;
    
    fetch(url)
    .then((res)=>res.json())
    .then((data)=>{
      let span = document.querySelector("#product-price");
      span.textContent = `â‚¹ ${data['price']}`;
    })
  }
</script>
{% endblock %}